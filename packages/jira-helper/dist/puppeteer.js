"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
// tslint:disable: no-console
const rxjs_1 = require("rxjs");
const puppeteer_core_1 = tslib_1.__importDefault(require("puppeteer-core"));
// import * as jira from './jira';
const jira_1 = require("./jira");
const operators_1 = require("rxjs/operators");
const jsYaml = tslib_1.__importStar(require("js-yaml"));
const log = require('log4js').getLogger('jira-helper');
const path_1 = tslib_1.__importDefault(require("path"));
const __api_1 = tslib_1.__importDefault(require("__api"));
const fs_1 = tslib_1.__importDefault(require("fs"));
const lodash_1 = tslib_1.__importDefault(require("lodash"));
// import os from 'os';
function login() {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const browser = yield launch();
        const pages = yield browser.pages();
        yield pages[0].goto('https://trello.com', { timeout: 0, waitUntil: 'domcontentloaded' });
    });
}
exports.login = login;
function launch(headless = false) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        let executablePath;
        switch (process.platform) {
            // Refer to https://chromium.googlesource.com/chromium/src/+/master/docs/user_data_dir.md#Mac-OS-X
            case 'darwin':
                executablePath = '/Applications/Google Chrome.app/Contents/MacOS/Google Chrome';
                break;
            case 'win32':
                executablePath = path_1.default.resolve(process.env['ProgramFiles(x86)'] || 'c:/Program Files (x86)', 'Google/Chrome/Application/chrome.exe');
                break;
            default:
                const msg = 'jira-helper does not support this platform ' + process.platform;
                log.error(msg);
                throw new Error(msg);
        }
        if (__api_1.default.argv.headless === true) {
            log.info('Enable headless mode');
            headless = true;
        }
        const browser = yield puppeteer_core_1.default.launch({
            headless,
            executablePath: executablePath,
            userDataDir: process.cwd() + '/dist/puppeteer-temp',
            ignoreHTTPSErrors: true,
            defaultViewport: { width: 1236, height: 768 }
        });
        return browser;
    });
}
function run() {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const browser = yield launch(false);
        const pages = yield browser.pages();
        // const page = await browser.newPage();
        console.time('get page');
        // tslint:disable-next-line: max-line-length
        const url = 'https://trello.com/b/i6yaHbFX/%E8%B4%9D%E7%94%A8%E9%87%91%E8%B4%9D%E5%88%86%E6%9C%9F%E4%BA%A7%E5%93%81%E5%8E%9F%E4%BF%A1%E7%94%A8%E4%BA%8B%E4%B8%9A%E9%83%A8%E5%89%8D%E7%AB%AF%E5%9B%A2%E9%98%9F';
        log.info('GET ' + url);
        yield pages[0].goto(url, { timeout: 0, waitUntil: 'networkidle2' });
        console.log('fetching trello done');
        console.timeEnd('get page');
        const boards = yield listBoards(pages[0]);
        console.log(jsYaml.safeDump(boards));
        yield browser.close();
        console.log('Have a nice day');
    });
}
exports.run = run;
function listBoards(page) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        yield page.waitFor('#board', { visible: true });
        const boards = yield page.$$('#board > .list-wrapper > .list');
        return rxjs_1.from(boards).pipe(operators_1.mergeMap(boardEl => {
            return rxjs_1.forkJoin(rxjs_1.from(boardEl.$('.list-header h2')).pipe(operators_1.mergeMap(bdTitle => rxjs_1.from(bdTitle.getProperty('innerText'))), operators_1.mergeMap(value => rxjs_1.from(value.jsonValue()))), rxjs_1.from(boardEl.$$('.list-card .list-card-title')).pipe(operators_1.mergeMap(cards => rxjs_1.from(cards)), operators_1.mergeMap(card => {
                return rxjs_1.forkJoin(rxjs_1.from(card.$('.card-short-id')).pipe(operators_1.mergeMap(id => id.getProperty('innerText')), operators_1.mergeMap(jh => rxjs_1.from(jh.jsonValue()))), rxjs_1.from(card.getProperty('innerText')).pipe(operators_1.mergeMap(jh => rxjs_1.from(jh.jsonValue()))));
            }), operators_1.map(([shortId, title]) => ({ title, shortId })), operators_1.reduce((cards, card) => {
                cards.push(card);
                return cards;
            }, [])));
        }), operators_1.map(([name, cards]) => {
            log.info(` [ ${name} ] `);
            log.info(cards.map(card => `  - ${card.shortId}: ${card.title}`).join('\n'));
            return { name, cards };
        }), operators_1.reduce((boards, bd) => {
            boards.push(bd);
            return boards;
        }, [])).toPromise();
    });
}
function main() {
    console.log(__api_1.default.argv);
}
exports.main = main;
function loginJira() {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const browser = yield launch(false);
        const pages = yield browser.pages();
        yield pages[0].goto('https://issue.bkjk-inc.com', { timeout: 0, waitUntil: 'domcontentloaded' });
    });
}
exports.loginJira = loginJira;
function listJira(
// tslint:disable-next-line: max-line-length
url = 'https://issue.bkjk-inc.com/issues/?filter=14086&jql=project%20%3D%20BYJ%20AND%20issuetype%20in%20(%E4%BB%BB%E5%8A%A1%2C%20%E6%95%85%E4%BA%8B)%20AND%20resolution%20%3D%20Unresolved%20AND%20fixVersion%20%3D%20%22%E8%B4%9D%E7%94%A8%E9%87%91v1.9%2F910%22%20ORDER%20BY%20key%20DESC%2C%20summary%20DESC%2C%20updated%20DESC') {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const browser = yield launch(false);
        const pages = yield browser.pages();
        yield pages[0].goto(url, { timeout: 0, waitUntil: 'networkidle2' });
        console.log('fetching page done');
        const page = pages[0];
        const table = yield page.$('#issuetable > tbody');
        const keys = yield table.$$('tr');
        const issues = yield Promise.all(keys.map((row) => tslib_1.__awaiter(this, void 0, void 0, function* () {
            const issue = yield row.getProperty('innerText').then(v => v.jsonValue())
                .then((str) => str.split(/\s+/))
                .then(cols => jira_1.columnsToIssue(...cols));
            // log.info(issue);
            return issue;
        })));
        for (const issue of issues) {
            yield page.goto('https://issue.bkjk-inc.com/browse/' + issue.id, { timeout: 0, waitUntil: 'networkidle2' });
            issue.tasks = yield listSubtasks(page, issue.id);
        }
        // keys.map(row => row.getProperties().then(props => Array.from(props.keys()))));
        log.info(jsYaml.safeDump(issues));
        yield browser.close();
        console.log('Have a nice day');
    });
}
exports.listJira = listJira;
function syncJira() {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const browser = yield launch(false);
        const pages = yield browser.pages();
        const issues = jsYaml.load(fs_1.default.readFileSync(__dirname + '/../add-jira.yaml', 'utf8'));
        log.info(issues.length);
        for (const issue of issues) {
            if (!issue.tasks)
                continue;
            log.info('Check issue', issue.id);
            const tasksWithoutId = issue.tasks.filter(task => task.id == null);
            // log.info(tasksWithoutId);
            if (tasksWithoutId.length === 0)
                continue;
            const remoteTasks = yield listSubtasks(pages[0], issue.id);
            issue.ver = yield pages[0].$('#fixfor-val').then(el => el.getProperty('innerText')).then(jh => jh.jsonValue());
            const toAdd = lodash_1.default.differenceBy(tasksWithoutId, remoteTasks, issue => issue.name);
            log.info(toAdd);
            for (const item of toAdd) {
                item.ver = issue.ver;
                yield addSubTask(pages[0], item);
            }
        }
        browser.close();
    });
}
exports.syncJira = syncJira;
function issueDetail() {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const browser = yield launch(false);
        const pages = yield browser.pages();
        const tasks = yield listSubtasks(pages[0], 'BYJ-2141');
        log.info(tasks);
        yield browser.close();
    });
}
exports.issueDetail = issueDetail;
function addSubTask(page, task) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        log.info('adding', task);
        const moreBtn = yield page.$('#opsbar-operations_more');
        if (moreBtn == null)
            throw new Error('#opsbar-operations_more not found in page'); // click 更多
        // log.warn(await moreBtn.getProperty('innerText').then(jh => jh.jsonValue()));
        yield moreBtn.click({ delay: 100 });
        yield page.waitFor('#opsbar-operations_more_drop', { visible: true });
        const menuItems = yield page.$$('#opsbar-operations_more_drop .trigger-label');
        for (const item of menuItems) {
            const text = yield item.getProperty('innerHTML').then(jh => jh.jsonValue());
            if (text === '创建子任务') {
                yield item.click();
                break;
            }
        }
        yield page.waitFor('#create-subtask-dialog', { visible: true });
        const dialog = yield page.$('#create-subtask-dialog');
        if (!dialog)
            throw new Error('Adding issue dialog not found');
        yield dialog.$('input[name=summary]')
            .then(input => input.type(task.name.startsWith('FE ') ? task.name : 'FE - ' + task.name));
        const input = yield dialog.$('#fixVersions-textarea');
        yield input.click();
        yield input.type(task.ver);
        yield page.keyboard.press('Enter');
        yield dialog.$('#description-wiki-edit').then(el => el.click());
        yield page.keyboard.type(task.desc ? task.desc : task.name);
        const labels = yield dialog.$$('.field-group > label');
        const texts = yield Promise.all(labels.map(label => label.getProperty('innerText').then(v => v.jsonValue())));
        const labelMap = {};
        texts.forEach((text, idx) => labelMap[text.split(/[\n\r\t]+/)[0]] = labels[idx]);
        // log.info(Object.keys(labelMap));
        const matchName = /[(（]([0-9.][dhDH]?)[)）]\s*$/.exec(task.name);
        let duration = matchName ? matchName[1] : '0.5d';
        if (!duration.endsWith('d') && !duration.endsWith('h')) {
            duration = duration + 'd';
        }
        const formValues = {
            'Start date': '26/八月/19',
            'End date': '26/九月/19',
            // tslint:disable-next-line: object-literal-key-quotes
            '初始预估': duration,
            剩余的估算: duration,
            经办人: task.assignee || '刘晶'
        };
        for (const name of Object.keys(labelMap)) {
            if (!lodash_1.default.has(formValues, name))
                continue;
            yield labelMap[name].click({ delay: 50 });
            yield new Promise(resolve => setTimeout(resolve, 200));
            yield page.keyboard.type(formValues[name], { delay: 50 });
            if (name === '经办人') {
                yield new Promise(resolve => setTimeout(resolve, 500)); // wait for JIRA searching user
                yield page.keyboard.press('Enter', { delay: 50 });
            }
        }
        yield dialog.$('#create-issue-submit').then(btn => btn.click());
        yield page.waitFor('#create-subtask-dialog', { hidden: true });
        yield new Promise(resolve => setTimeout(resolve, 1000));
    });
}
function listSubtasks(page, issueId) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        yield page.goto('https://issue.bkjk-inc.com/browse/' + issueId, { timeout: 0, waitUntil: 'networkidle2' });
        const tasks = yield page.$$eval('#view-subtasks #issuetable > tbody > tr', (els) => {
            // return els.length;
            return els.map(el => {
                const name = el.querySelector('.stsummary');
                const subtask = {
                    id: el.getAttribute('data-issuekey'),
                    name: name ? name.innerText : '',
                    // state: '',
                    state: el.querySelector('.status').innerText,
                    ver: '',
                    // assignee: ''
                    assignee: el.querySelector('.assignee').innerText
                };
                return subtask;
            });
        });
        return tasks;
    });
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9AZHIvamlyYS1oZWxwZXIvdHMvcHVwcGV0ZWVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDZCQUE2QjtBQUM3QiwrQkFBZ0Q7QUFDaEQsNEVBQWlDO0FBRWpDLGtDQUFrQztBQUNsQyxpQ0FBNkM7QUFDN0MsOENBQXFEO0FBQ3JELHdEQUFrQztBQUNsQyxNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ3ZELHdEQUF3QjtBQUN4QiwwREFBd0I7QUFDeEIsb0RBQW9CO0FBQ3BCLDREQUF1QjtBQUV2Qix1QkFBdUI7QUFDdkIsU0FBc0IsS0FBSzs7UUFDekIsTUFBTSxPQUFPLEdBQUcsTUFBTSxNQUFNLEVBQUUsQ0FBQztRQUMvQixNQUFNLEtBQUssR0FBRyxNQUFNLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNwQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLEVBQ3RDLEVBQUMsT0FBTyxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsa0JBQWtCLEVBQUMsQ0FBQyxDQUFDO0lBQ2pELENBQUM7Q0FBQTtBQUxELHNCQUtDO0FBRUQsU0FBZSxNQUFNLENBQUMsUUFBUSxHQUFHLEtBQUs7O1FBQ3BDLElBQUksY0FBc0IsQ0FBQztRQUUzQixRQUFRLE9BQU8sQ0FBQyxRQUFRLEVBQUU7WUFDeEIsa0dBQWtHO1lBQ2xHLEtBQUssUUFBUTtnQkFDWCxjQUFjLEdBQUcsOERBQThELENBQUM7Z0JBQ2hGLE1BQU07WUFDUixLQUFLLE9BQU87Z0JBQ1YsY0FBYyxHQUFHLGNBQUksQ0FBQyxPQUFPLENBQzdCLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLENBQUMsSUFBSSx3QkFBd0IsRUFBRSxzQ0FBc0MsQ0FBQyxDQUFDO2dCQUN0RyxNQUFNO1lBQ1I7Z0JBQ0UsTUFBTSxHQUFHLEdBQUcsNkNBQTZDLEdB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LEdBQXVCLEVBQUUsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQ2hFLE1BQU0sT0FBTyxHQUFVO29CQUNyQixFQUFFLEVBQUUsRUFBRSxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUU7b0JBQ3JDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUU7b0JBQ2hDLGFBQWE7b0JBQ2IsS0FBSyxFQUFHLEVBQUUsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFpQixDQUFDLFNBQVM7b0JBQzdELEdBQUcsRUFBRSxFQUFFO29CQUNQLGVBQWU7b0JBQ2YsUUFBUSxFQUFHLEVBQUUsQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFpQixDQUFDLFNBQVM7aUJBQ25FLENBQUM7Z0JBQ0YsT0FBTyxPQUFPLENBQUM7WUFDakIsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztDQUFBIiwiZmlsZSI6Im5vZGVfbW9kdWxlcy9AZHIvamlyYS1oZWxwZXIvZGlzdC9wdXBwZXRlZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0c2xpbnQ6ZGlzYWJsZTogbm8tY29uc29sZVxuaW1wb3J0IHtmcm9tLCBmb3JrSm9pbiwgT2JzZXJ2YWJsZX0gZnJvbSAncnhqcyc7XG5pbXBvcnQgcHVwIGZyb20gJ3B1cHBldGVlci1jb3JlJztcbmltcG9ydCAqIGFzIHRyIGZyb20gJy4vdHJlbGxvJztcbi8vIGltcG9ydCAqIGFzIGppcmEgZnJvbSAnLi9qaXJhJztcbmltcG9ydCB7SXNzdWUsIGNvbHVtbnNUb0lzc3VlfSBmcm9tICcuL2ppcmEnO1xuaW1wb3J0IHttZXJnZU1hcCwgbWFwLCByZWR1Y2V9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCAqIGFzIGpzWWFtbCBmcm9tICdqcy15YW1sJztcbmNvbnN0IGxvZyA9IHJlcXVpcmUoJ2xvZzRqcycpLmdldExvZ2dlcignamlyYS1oZWxwZXInKTtcbmltcG9ydCBQYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IGFwaSBmcm9tICdfX2FwaSc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuLy8gaW1wb3J0IG9zIGZyb20gJ29zJztcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dpbigpIHtcbiAgY29uc3QgYnJvd3NlciA9IGF3YWl0IGxhdW5jaCgpO1xuICBjb25zdCBwYWdlcyA9IGF3YWl0IGJyb3dzZXIucGFnZXMoKTtcbiAgYXdhaXQgcGFnZXNbMF0uZ290bygnaHR0cHM6Ly90cmVsbG8uY29tJyxcbiAgICB7dGltZW91dDogMCwgd2FpdFVudGlsOiAnZG9tY29udGVudGxvYWRlZCd9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gbGF1bmNoKGhlYWRsZXNzID0gZmFsc2UpOiBQcm9taXNlPHB1cC5Ccm93c2VyPiB7XG4gIGxldCBleGVjdXRhYmxlUGF0aDogc3RyaW5nO1xuXG4gIHN3aXRjaCAocHJvY2Vzcy5wbGF0Zm9ybSkge1xuICAgIC8vIFJlZmVyIHRvIGh0dHBzOi8vY2hyb21pdW0uZ29vZ2xlc291cmNlLmNvbS9jaHJvbWl1bS9zcmMvKy9tYXN0ZXIvZG9jcy91c2VyX2RhdGFfZGlyLm1kI01hYy1PUy1YXG4gICAgY2FzZSAnZGFyd2luJzpcbiAgICAgIGV4ZWN1dGFibGVQYXRoID0gJy9BcHBsaWNhdGlvbnMvR29vZ2xlIENocm9tZS5hcHAvQ29udGVudHMvTWFjT1MvR29vZ2xlIENocm9tZSc7XG4gICAgICBicmVhaztcbiAgICBjYXNlICd3aW4zMic6XG4gICAgICBleGVjdXRhYmxlUGF0aCA9IFBhdGgucmVzb2x2ZShcbiAgICAgIHByb2Nlc3MuZW52WydQcm9ncmFtRmlsZXMoeDg2KSddIHx8ICdjOi9Qcm9ncmFtIEZpbGVzICh4ODYpJywgJ0dvb2dsZS9DaHJvbWUvQXBwbGljYXRpb24vY2hyb21lLmV4ZScpO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIGNvbnN0IG1zZyA9ICdqaXJhLWhlbHBlciBkb2VzIG5vdCBzdXBwb3J0IHRoaXMgcGxhdGZvcm0gJyArIHByb2Nlc3MucGxhdGZvcm07XG4gICAgICBsb2cuZXJyb3IobXNnKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihtc2cpO1xuICB9XG4gIGlmIChhcGkuYXJndi5oZWFkbGVzcyA9PT0gdHJ1ZSkge1xuICAgIGxvZy5pbmZvKCdFbmFibGUgaGVhZGxlc3MgbW9kZScpO1xuICAgIGhlYWRsZXNzID0gdHJ1ZTtcbiAgfVxuICBjb25zdCBicm93c2VyID0gYXdhaXQgcHVwLmxhdW5jaCh7XG4gICAgaGVhZGxlc3MsXG4gICAgZXhlY3V0YWJsZVBhdGg6IGV4ZWN1dGFibGVQYXRoISxcbiAgICB1c2VyRGF0YURpcjogcHJvY2Vzcy5jd2QoKSArICcvZGlzdC9wdXBwZXRlZXItdGVtcCcsXG4gICAgaWdub3JlSFRUUFNFcnJvcnM6IHRydWUsXG4gICAgZGVmYXVsdFZpZXdwb3J0OiB7d2lkdGg6IDEyMzYsIGhlaWdodDogNzY4fVxuICB9KTtcbiAgcmV0dXJuIGJyb3dzZXI7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBydW4oKSB7XG4gIGNvbnN0IGJyb3dzZXIgPSBhd2FpdCBsYXVuY2goZmFsc2UpO1xuXG4gIGNvbnN0IHBhZ2VzID0gYXdhaXQgYnJvd3Nlci5wYWdlcygpO1xuICAvLyBjb25zdCBwYWdlID0gYXdhaXQgYnJvd3Nlci5uZXdQYWdlKCk7XG4gIGNvbnNvbGUudGltZSgnZ2V0IHBhZ2UnKTtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBtYXgtbGluZS1sZW5ndGhcbiAgY29uc3QgdXJsID0gJ2h0dHBzOi8vdHJlbGxvLmNvbS9iL2k2eWFIYkZYLyVFOCVCNCU5RCVFNyU5NCVBOCVFOSU4NyU5MSVFOCVCNCU5RCVFNSU4OCU4NiVFNiU5QyU5RiVFNCVCQSVBNyVFNSU5MyU4MSVFNSU4RSU5RiVFNCVCRiVBMSVFNyU5NCVBOCVFNCVCQSU4QiVFNCVCOCU5QSVFOSU4MyVBOCVFNSU4OSU4RCVFNyVBQiVBRiVFNSU5QiVBMiVFOSU5OCU5Ric7XG4gIGxvZy5pbmZvKCdHRVQgJyArIHVybCk7XG5cbiAgYXdhaXQgcGFnZXNbMF0uZ290byh1cmwsIHt0aW1lb3V0OiAwLCB3YWl0VW50aWw6ICduZXR3b3JraWRsZTInfSk7XG4gIGNvbnNvbGUubG9nKCdmZXRjaGluZyB0cmVsbG8gZG9uZScpO1xuICBjb25zb2xlLnRpbWVFbmQoJ2dldCBwYWdlJyk7XG4gIGNvbnN0IGJvYXJkcyA9IGF3YWl0IGxpc3RCb2FyZHMocGFnZXNbMF0pO1xuICBjb25zb2xlLmxvZyhqc1lhbWwuc2FmZUR1bXAoYm9hcmRzKSk7XG4gIGF3YWl0IGJyb3dzZXIuY2xvc2UoKTtcbiAgY29uc29sZS5sb2coJ0hhdmUgYSBuaWNlIGRheScpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBsaXN0Qm9hcmRzKHBhZ2U6IHB1cC5QYWdlKTogUHJvbWlzZTx0ci5UcmVsbG9Cb2FyZFtdPiB7XG4gIGF3YWl0IHBhZ2Uud2FpdEZvcignI2JvYXJkJywge3Zpc2libGU6IHRydWV9KTtcbiAgY29uc3QgYm9hcmRzID0gYXdhaXQgcGFnZS4kJCgnI2JvYXJkID4gLmxpc3Qtd3JhcHBlciA+IC5saXN0Jyk7XG5cbiAgcmV0dXJuIGZyb20oYm9hcmRzKS5waXBlKFxuICAgIG1lcmdlTWFwKGJvYXJkRWwgPT4ge1xuICAgICAgcmV0dXJuIGZvcmtKb2luKFxuICAgICAgICBmcm9tKGJvYXJkRWwuJCgnLmxpc3QtaGVhZGVyIGgyJykpLnBpcGUoXG4gICAgICAgICAgbWVyZ2VNYXAoYmRUaXRsZSA9PiBmcm9tKGJkVGl0bGUhLmdldFByb3BlcnR5KCdpbm5lclRleHQnKSkpLFxuICAgICAgICAgIG1lcmdlTWFwKHZhbHVlID0+IGZyb20odmFsdWUuanNvblZhbHVlKCkgYXMgUHJvbWlzZTxzdHJpbmc+KSlcbiAgICAgICAgKSxcbiAgICAgICAgZnJvbShib2FyZEVsLiQkKCcubGlzdC1jYXJkIC5saXN0LWNhcmQtdGl0bGUnKSkucGlwZShcbiAgICAgICAgICBtZXJnZU1hcChjYXJkcyA9PiBmcm9tKGNhcmRzKSksXG4gICAgICAgICAgbWVyZ2VNYXAoY2FyZCA9PiB7XG4gICAgICAgICAgICByZXR1cm4gZm9ya0pvaW4oXG4gICAgICAgICAgICAgIGZyb20oY2FyZC4kKCcuY2FyZC1zaG9ydC1pZCcpKS5waXBlKFxuICAgICAgICAgICAgICAgIG1lcmdlTWFwKGlkID0+IGlkIS5nZXRQcm9wZXJ0eSgnaW5uZXJUZXh0JykpLFxuICAgICAgICAgICAgICAgIG1lcmdlTWFwKGpoID0+IGZyb20oamguanNvblZhbHVlKCkpIGFzIE9ic2VydmFibGU8c3RyaW5nPilcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgZnJvbShjYXJkLmdldFByb3BlcnR5KCdpbm5lclRleHQnKSkucGlwZShcbiAgICAgICAgICAgICAgICBtZXJnZU1hcChqaCA9PiBmcm9tKGpoLmpzb25WYWx1ZSgpKSBhcyBPYnNlcnZhYmxlPHN0cmluZz4pXG4gICAgICAgICAgICAgICkpO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIG1hcCgoW3Nob3J0SWQsIHRpdGxlXSkgPT4gKHt0aXRsZSwgc2hvcnRJZH0gYXMgdHIuVHJlbGxvQ2FyZCkpLFxuICAgICAgICAgIHJlZHVjZTx0ci5UcmVsbG9DYXJkPigoY2FyZHMsIGNhcmQpPT4ge1xuICAgICAgICAgICAgY2FyZHMucHVzaChjYXJkKTtcbiAgICAgICAgICAgIHJldHVybiBjYXJkcztcbiAgICAgICAgICB9LCBbXSlcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9KSxcbiAgICBtYXAoKFtuYW1lLCBjYXJkc10pID0+IHtcbiAgICAgIGxvZy5pbmZvKGAgWyAke25hbWV9IF0gYCk7XG4gICAgICBsb2cuaW5mbyhjYXJkcy5tYXAoY2FyZCA9PiBgICAtICR7Y2FyZC5zaG9ydElkfTogJHtjYXJkLnRpdGxlfWApLmpvaW4oJ1xcbicpKTtcbiAgICAgIHJldHVybiB7bmFtZSwgY2FyZHN9IGFzIHRyLlRyZWxsb0JvYXJkO1xuICAgIH0pLFxuICAgIHJlZHVjZTx0ci5UcmVsbG9Cb2FyZD4oKGJvYXJkcywgYmQpID0+IHtcbiAgICAgIGJvYXJkcy5wdXNoKGJkKTtcbiAgICAgIHJldHVybiBib2FyZHM7XG4gICAgfSwgW10pXG4gICkudG9Qcm9taXNlKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYWluKCkge1xuICBjb25zb2xlLmxvZyhhcGkuYXJndik7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dpbkppcmEoKSB7XG4gIGNvbnN0IGJyb3dzZXIgPSBhd2FpdCBsYXVuY2goZmFsc2UpO1xuICBjb25zdCBwYWdlcyA9IGF3YWl0IGJyb3dzZXIucGFnZXMoKTtcbiAgYXdhaXQgcGFnZXNbMF0uZ290bygnaHR0cHM6Ly9pc3N1ZS5ia2prLWluYy5jb20nLFxuICAgIHt0aW1lb3V0OiAwLCB3YWl0VW50aWw6ICdkb21jb250ZW50bG9hZGVkJ30pO1xufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsaXN0SmlyYShcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBtYXgtbGluZS1sZW5ndGhcbiAgdXJsID0gJ2h0dHBzOi8vaXNzdWUuYmtqay1pbmMuY29tL2lzc3Vlcy8/ZmlsdGVyPTE0MDg2JmpxbD1wcm9qZWN0JTIwJTNEJTIwQllKJTIwQU5EJTIwaXNzdWV0eXBlJTIwaW4lMjAoJUU0JUJCJUJCJUU1JThBJUExJTJDJTIwJUU2JTk1JTg1JUU0JUJBJThCKSUyMEFORCUyMHJlc29sdXRpb24lMjAlM0QlMjBVbnJlc29sdmVkJTIwQU5EJTIwZml4VmVyc2lvbiUyMCUzRCUyMCUyMiVFOCVCNCU5RCVFNyU5NCVBOCVFOSU4NyU5MXYxLjklMkY5MTAlMjIlMjBPUkRFUiUyMEJZJTIwa2V5JTIwREVTQyUyQyUyMHN1bW1hcnklMjBERVNDJTJDJTIwdXBkYXRlZCUyMERFU0MnKSB7XG4gIGNvbnN0IGJyb3dzZXIgPSBhd2FpdCBsYXVuY2goZmFsc2UpO1xuICBjb25zdCBwYWdlcyA9IGF3YWl0IGJyb3dzZXIucGFnZXMoKTtcbiAgYXdhaXQgcGFnZXNbMF0uZ290byh1cmwsIHt0aW1lb3V0OiAwLCB3YWl0VW50aWw6ICduZXR3b3JraWRsZTInfSk7XG4gIGNvbnNvbGUubG9nKCdmZXRjaGluZyBwYWdlIGRvbmUnKTtcbiAgY29uc3QgcGFnZSA9IHBhZ2VzWzBdO1xuXG4gIGNvbnN0IHRhYmxlID0gYXdhaXQgcGFnZS4kKCcjaXNzdWV0YWJsZSA+IHRib2R5Jyk7XG5cbiAgY29uc3Qga2V5cyA9IGF3YWl0IHRhYmxlIS4kJCgndHInKTtcbiAgY29uc3QgaXNzdWVzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAga2V5cy5tYXAoYXN5bmMgcm93ID0+IHtcbiAgICAgIGNvbnN0IGlzc3VlID0gYXdhaXQgcm93LmdldFByb3BlcnR5KCdpbm5lclRleHQnKS50aGVuKHYgPT4gdi5qc29uVmFsdWUoKSlcbiAgICAgICAgLnRoZW4oKHN0cjogc3RyaW5nKSA9PiBzdHIuc3BsaXQoL1xccysvKSlcbiAgICAgICAgLnRoZW4oY29scyA9PiBjb2x1bW5zVG9Jc3N1ZSguLi5jb2xzKSk7XG4gICAgICAvLyBsb2cuaW5mbyhpc3N1ZSk7XG4gICAgICByZXR1cm4gaXNzdWU7XG4gICAgfSlcbiAgKTtcblxuICBmb3IgKGNvbnN0IGlzc3VlIG9mIGlzc3Vlcykge1xuICAgIGF3YWl0IHBhZ2UuZ290bygnaHR0cHM6Ly9pc3N1ZS5ia2prLWluYy5jb20vYnJvd3NlLycgKyBpc3N1ZS5pZCwge3RpbWVvdXQ6IDAsIHdhaXRVbnRpbDogJ25ldHdvcmtpZGxlMid9KTtcbiAgICBpc3N1ZS50YXNrcyA9IGF3YWl0IGxpc3RTdWJ0YXNrcyhwYWdlLCBpc3N1ZS5pZCk7XG4gIH1cbiAgICAvLyBrZXlzLm1hcChyb3cgPT4gcm93LmdldFByb3BlcnRpZXMoKS50aGVuKHByb3BzID0+IEFycmF5LmZyb20ocHJvcHMua2V5cygpKSkpKTtcbiAgbG9nLmluZm8oanNZYW1sLnNhZmVEdW1wKGlzc3VlcykpO1xuXG4gIGF3YWl0IGJyb3dzZXIuY2xvc2UoKTtcbiAgY29uc29sZS5sb2coJ0hhdmUgYSBuaWNlIGRheScpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3luY0ppcmEoKSB7XG4gIGNvbnN0IGJyb3dzZXIgPSBhd2FpdCBsYXVuY2goZmFsc2UpO1xuICBjb25zdCBwYWdlcyA9IGF3YWl0IGJyb3dzZXIucGFnZXMoKTtcblxuICBjb25zdCBpc3N1ZXM6IElzc3VlW10gPSBqc1lhbWwubG9hZChmcy5yZWFkRmlsZVN5bmMoX19kaXJuYW1lICsgJy8uLi9hZGQtamlyYS55YW1sJywgJ3V0ZjgnKSk7XG4gIGxvZy5pbmZvKGlzc3Vlcy5sZW5ndGgpO1xuICBmb3IgKGNvbnN0IGlzc3VlIG9mIGlzc3Vlcykge1xuICAgIGlmICghaXNzdWUudGFza3MpXG4gICAgICBjb250aW51ZTtcbiAgICBsb2cuaW5mbygnQ2hlY2sgaXNzdWUnLCBpc3N1ZS5pZCk7XG5cbiAgICBjb25zdCB0YXNrc1dpdGhvdXRJZCA9IGlzc3VlLnRhc2tzLmZpbHRlcih0YXNrID0+IHRhc2suaWQgPT0gbnVsbCk7XG4gICAgLy8gbG9nLmluZm8odGFza3NXaXRob3V0SWQpO1xuICAgIGlmICh0YXNrc1dpdGhvdXRJZC5sZW5ndGggPT09IDApXG4gICAgICBjb250aW51ZTtcblxuICAgIGNvbnN0IHJlbW90ZVRhc2tzID0gYXdhaXQgbGlzdFN1YnRhc2tzKHBhZ2VzWzBdLCBpc3N1ZS5pZCk7XG4gICAgaXNzdWUudmVyID0gYXdhaXQgcGFnZXNbMF0uJCgnI2ZpeGZvci12YWwnKS50aGVuKGVsID0+IGVsIS5nZXRQcm9wZXJ0eSgnaW5uZXJUZXh0JykpLnRoZW4oamggPT4gamguanNvblZhbHVlKCkpO1xuXG4gICAgY29uc3QgdG9BZGQgPSBfLmRpZmZlcmVuY2VCeSh0YXNrc1dpdGhvdXRJZCwgcmVtb3RlVGFza3MsIGlzc3VlID0+IGlzc3VlLm5hbWUpO1xuICAgIGxvZy5pbmZvKHRvQWRkKTtcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdG9BZGQpIHtcbiAgICAgIGl0ZW0udmVyID0gaXNzdWUudmVyO1xuICAgICAgYXdhaXQgYWRkU3ViVGFzayhwYWdlc1swXSwgaXRlbSk7XG4gICAgfVxuICB9XG4gIGJyb3dzZXIuY2xvc2UoKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGlzc3VlRGV0YWlsKCkge1xuICBjb25zdCBicm93c2VyID0gYXdhaXQgbGF1bmNoKGZhbHNlKTtcbiAgY29uc3QgcGFnZXMgPSBhd2FpdCBicm93c2VyLnBhZ2VzKCk7XG4gIGNvbnN0IHRhc2tzID0gYXdhaXQgbGlzdFN1YnRhc2tzKHBhZ2VzWzBdLCAnQllKLTIxNDEnKTtcbiAgbG9nLmluZm8odGFza3MpO1xuICBhd2FpdCBicm93c2VyLmNsb3NlKCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGFkZFN1YlRhc2socGFnZTogcHVwLlBhZ2UsIHRhc2s6IElzc3VlKSB7XG4gIGxvZy5pbmZvKCdhZGRpbmcnLCB0YXNrKTtcbiAgY29uc3QgbW9yZUJ0biA9IGF3YWl0IHBhZ2UuJCgnI29wc2Jhci1vcGVyYXRpb25zX21vcmUnKTtcbiAgaWYgKG1vcmVCdG4gPT0gbnVsbClcbiAgICB0aHJvdyBuZXcgRXJyb3IoJyNvcHNiYXItb3BlcmF0aW9uc19tb3JlIG5vdCBmb3VuZCBpbiBwYWdlJyk7IC8vIGNsaWNrIOabtOWkmlxuICAvLyBsb2cud2Fybihhd2FpdCBtb3JlQnRuLmdldFByb3BlcnR5KCdpbm5lclRleHQnKS50aGVuKGpoID0+IGpoLmpzb25WYWx1ZSgpKSk7XG5cbiAgYXdhaXQgbW9yZUJ0biEuY2xpY2soe2RlbGF5OiAxMDB9KTtcbiAgYXdhaXQgcGFnZS53YWl0Rm9yKCcjb3BzYmFyLW9wZXJhdGlvbnNfbW9yZV9kcm9wJywge3Zpc2libGU6IHRydWV9KTtcblxuICBjb25zdCBtZW51SXRlbXMgPSBhd2FpdCBwYWdlLiQkKCcjb3BzYmFyLW9wZXJhdGlvbnNfbW9yZV9kcm9wIC50cmlnZ2VyLWxhYmVsJyk7XG4gIGZvciAoY29uc3QgaXRlbSBvZiBtZW51SXRlbXMpIHtcbiAgICBjb25zdCB0ZXh0OiBzdHJpbmcgPSBhd2FpdCBpdGVtLmdldFByb3BlcnR5KCdpbm5lckhUTUwnKS50aGVuKGpoID0+IGpoLmpzb25WYWx1ZSgpKTtcbiAgICBpZiAodGV4dCA9PT0gJ+WIm+W7uuWtkOS7u+WKoScpIHtcbiAgICAgIGF3YWl0IGl0ZW0uY2xpY2soKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIGF3YWl0IHBhZ2Uud2FpdEZvcignI2NyZWF0ZS1zdWJ0YXNrLWRpYWxvZycsIHt2aXNpYmxlOiB0cnVlfSk7XG4gIGNvbnN0IGRpYWxvZyA9IGF3YWl0IHBhZ2UuJCgnI2NyZWF0ZS1zdWJ0YXNrLWRpYWxvZycpO1xuICBpZiAoIWRpYWxvZylcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0FkZGluZyBpc3N1ZSBkaWFsb2cgbm90IGZvdW5kJyk7XG5cbiAgYXdhaXQgZGlhbG9nLiQoJ2lucHV0W25hbWU9c3VtbWFyeV0nKVxuICAgIC50aGVuKGlucHV0ID0+IGlucHV0IS50eXBlKHRhc2submFtZS5zdGFydHNXaXRoKCdGRSAnKSA/IHRhc2submFtZSA6ICdGRSAtICcgKyB0YXNrLm5hbWUpKTtcblxuICBjb25zdCBpbnB1dCA9IGF3YWl0IGRpYWxvZy4kKCcjZml4VmVyc2lvbnMtdGV4dGFyZWEnKTtcbiAgYXdhaXQgaW5wdXQhLmNsaWNrKCk7XG4gIGF3YWl0IGlucHV0IS50eXBlKHRhc2sudmVyKTtcbiAgYXdhaXQgcGFnZS5rZXlib2FyZC5wcmVzcygnRW50ZXInKTtcbiAgYXdhaXQgZGlhbG9nLiQoJyNkZXNjcmlwdGlvbi13aWtpLWVkaXQnKS50aGVuKGVsID0+IGVsIS5jbGljaygpKTtcbiAgYXdhaXQgcGFnZS5rZXlib2FyZC50eXBlKHRhc2suZGVzYyA/IHRhc2suZGVzYyA6IHRhc2submFtZSk7XG5cbiAgY29uc3QgbGFiZWxzID0gYXdhaXQgZGlhbG9nLiQkKCcuZmllbGQtZ3JvdXAgPiBsYWJlbCcpO1xuXG4gIGNvbnN0IHRleHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgbGFiZWxzLm1hcChsYWJlbCA9PiBsYWJlbC5nZXRQcm9wZXJ0eSgnaW5uZXJUZXh0JykudGhlbih2ID0+IHYuanNvblZhbHVlKCkgYXMgUHJvbWlzZTxzdHJpbmc+KSkpO1xuICBjb25zdCBsYWJlbE1hcDoge1tuYW1lOiBzdHJpbmddOiBwdXAuRWxlbWVudEhhbmRsZX0gPSB7fTtcbiAgdGV4dHMuZm9yRWFjaCgodGV4dCwgaWR4KSA9PiBsYWJlbE1hcFt0ZXh0LnNwbGl0KC9bXFxuXFxyXFx0XSsvKVswXV0gPSBsYWJlbHNbaWR4XSk7XG4gIC8vIGxvZy5pbmZvKE9iamVjdC5rZXlzKGxhYmVsTWFwKSk7XG5cbiAgY29uc3QgbWF0Y2hOYW1lID0gL1so77yIXShbMC05Ll1bZGhESF0/KVsp77yJXVxccyokLy5leGVjKHRhc2submFtZSk7XG4gIGxldCBkdXJhdGlvbiA9IG1hdGNoTmFtZSA/IG1hdGNoTmFtZVsxXSA6ICcwLjVkJztcbiAgaWYgKCFkdXJhdGlvbi5lbmRzV2l0aCgnZCcpICYmICFkdXJhdGlvbi5lbmRzV2l0aCgnaCcpKSB7XG4gICAgZHVyYXRpb24gPSBkdXJhdGlvbiArICdkJztcbiAgfVxuICBjb25zdCBmb3JtVmFsdWVzID0ge1xuICAgICdTdGFydCBkYXRlJzogJzI2L+WFq+aciC8xOScsXG4gICAgJ0VuZCBkYXRlJzogJzI2L+S5neaciC8xOScsXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBvYmplY3QtbGl0ZXJhbC1rZXktcXVvdGVzXG4gICAgJ+WIneWni+mihOS8sCc6IGR1cmF0aW9uLFxuICAgIOWJqeS9meeahOS8sOeulzogZHVyYXRpb24sXG4gICAg57uP5Yqe5Lq6OiB0YXNrLmFzc2lnbmVlIHx8ICfliJjmmbYnXG4gIH07XG5cbiAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5rZXlzKGxhYmVsTWFwKSkge1xuICAgIGlmICghXy5oYXMoZm9ybVZhbHVlcywgbmFtZSkpXG4gICAgICBjb250aW51ZTtcbiAgICBhd2FpdCBsYWJlbE1hcFtuYW1lXS5jbGljayh7ZGVsYXk6IDUwfSk7XG4gICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDIwMCkpO1xuICAgIGF3YWl0IHBhZ2Uua2V5Ym9hcmQudHlwZShmb3JtVmFsdWVzW25hbWVdLCB7ZGVsYXk6IDUwfSk7XG4gICAgaWYgKG5hbWUgPT09ICfnu4/lip7kuronKSB7XG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgNTAwKSk7IC8vIHdhaXQgZm9yIEpJUkEgc2VhcmNoaW5nIHVzZXJcbiAgICAgIGF3YWl0IHBhZ2Uua2V5Ym9hcmQucHJlc3MoJ0VudGVyJywge2RlbGF5OiA1MH0pO1xuICAgIH1cbiAgfVxuICBhd2FpdCBkaWFsb2cuJCgnI2NyZWF0ZS1pc3N1ZS1zdWJtaXQnKS50aGVuKGJ0biA9PiBidG4hLmNsaWNrKCkpO1xuICBhd2FpdCBwYWdlLndhaXRGb3IoJyNjcmVhdGUtc3VidGFzay1kaWFsb2cnLCB7aGlkZGVuOiB0cnVlfSk7XG5cbiAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gbGlzdFN1YnRhc2tzKHBhZ2U6IHB1cC5QYWdlLCBpc3N1ZUlkOiBzdHJpbmcpIHtcbiAgYXdhaXQgcGFnZS5nb3RvKCdodHRwczovL2lzc3VlLmJramstaW5jLmNvbS9icm93c2UvJyArIGlzc3VlSWQsIHt0aW1lb3V0OiAwLCB3YWl0VW50aWw6ICduZXR3b3JraWRsZTInfSk7XG4gIGNvbnN0IHRhc2tzID0gYXdhaXQgcGFnZS4kJGV2YWwoJyN2aWV3LXN1YnRhc2tzICNpc3N1ZXRhYmxlID4gdGJvZHkgPiB0cicsIChlbHMpID0+IHtcbiAgICAvLyByZXR1cm4gZWxzLmxlbmd0aDtcbiAgICByZXR1cm4gZWxzLm1hcChlbCA9PiB7XG4gICAgICBjb25zdCBuYW1lOiBIVE1MRWxlbWVudCB8IG51bGwgPSBlbC5xdWVyeVNlbGVjdG9yKCcuc3RzdW1tYXJ5Jyk7XG4gICAgICBjb25zdCBzdWJ0YXNrOiBJc3N1ZSA9IHtcbiAgICAgICAgaWQ6IGVsLmdldEF0dHJpYnV0ZSgnZGF0YS1pc3N1ZWtleScpISxcbiAgICAgICAgbmFtZTogbmFtZSA/IG5hbWUuaW5uZXJUZXh0IDogJycsXG4gICAgICAgIC8vIHN0YXRlOiAnJyxcbiAgICAgICAgc3RhdGU6IChlbC5xdWVyeVNlbGVjdG9yKCcuc3RhdHVzJykgYXMgSFRNTEVsZW1lbnQpLmlubmVyVGV4dCxcbiAgICAgICAgdmVyOiAnJyxcbiAgICAgICAgLy8gYXNzaWduZWU6ICcnXG4gICAgICAgIGFzc2lnbmVlOiAoZWwucXVlcnlTZWxlY3RvcignLmFzc2lnbmVlJykgYXMgSFRNTEVsZW1lbnQpLmlubmVyVGV4dFxuICAgICAgfTtcbiAgICAgIHJldHVybiBzdWJ0YXNrO1xuICAgIH0pO1xuICB9KTtcbiAgcmV0dXJuIHRhc2tzO1xufVxuIl19
